---
- name: Install fish
  ansible.builtin.package:
    name: fish
    state: present
  become: "{{ package_become }}"

- name: Create ~/.config/fish directories
  ansible.builtin.file:
    path: ~/.config/fish/{{ item }}
    state: directory
  loop:
    - completions
    - conf.d
    - functions

- name: Copy common configuration
  ansible.builtin.copy:
    src: common/
    dest: ~/.config/fish/

- name: Copy macOS-specific configuration
  ansible.builtin.copy:
    src: Darwin/
    dest: ~/.config/fish/

- name: Apply environment template
  ansible.builtin.template:
    src: conf.d/00-env.fish.j2
    dest: ~/.config/fish/conf.d/00-env.fish

- name: Install fisher
  ansible.builtin.shell: curl -sL https://git.io/fisher | source && fisher install jorgebucaran/fisher
  args:
    creates: ~/.config/fish/functions/fisher.fish
